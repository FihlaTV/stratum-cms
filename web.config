<?xml version="1.0" encoding="UTF-8"?>
<configuration>
	<system.webServer>
		<handlers>
			<add name="iisnode" path="keystone.js" verb="*" modules="iisnode" />
		</handlers>
		<rewrite>
			<rules>
				<rule name="Main" stopProcessing="false">
					<match url="(.*)" />
					<conditions>
						<add input="{HTTP_HOST}" pattern="^|(www\.)stratum-cms" />
					</conditions>
					<action type="Rewrite" url="keystone.js" />
				</rule>
				<rule name="Registers" stopProcessing="false">
					<match url="(.*)" />
					<conditions>
						<add input="{HTTP_HOST}" negate="true" pattern="^www\.stratum-cms" />
						<add input="{HTTP_HOST}" pattern="^([a-zA-Z0-9]+)\.stratum-cms" />
					</conditions>
					<action type="Rewrite" url="registers/{C:1}/keystone.js" />
				</rule>
			</rules>
		</rewrite>
		<directoryBrowse enabled="true" />
		<iisnode loggingEnabled="true" logDirectory="logs" devErrorsEnabled="true" debuggingEnabled="true" nodeProcessCountPerApplication="0" />
	</system.webServer>
</configuration>
